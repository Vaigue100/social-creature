<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatlings Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #999;
            margin-bottom: 30px;
        }

        .admin-links {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .admin-link {
            display: block;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s;
            text-align: center;
        }

        .admin-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .admin-link .title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .admin-link .description {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .status {
            margin-top: 30px;
            padding: 15px;
            background: #f0f0ff;
            border-radius: 8px;
            font-size: 0.9em;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chatlings Admin</h1>
        <p class="subtitle">Administration & Quality Control</p>

        <div class="admin-links">
            <a href="/admin/manage-chatlings.html" class="admin-link">
                <div class="title">ü¶ã Manage Chatlings</div>
                <div class="description">Manage chatlings: animations, names, rarity, and retirement</div>
            </a>

            <a href="/admin/image-selection.html" class="admin-link">
                <div class="title">üñºÔ∏è Image Selection</div>
                <div class="description">Select images for new creatures</div>
            </a>

            <a href="/admin/review-conversations.html" class="admin-link">
                <div class="title">üîç Review Conversations</div>
                <div class="description">View and flag recent chatroom conversations</div>
            </a>

            <a href="/user/chatroom-demo.html" class="admin-link">
                <div class="title">üí¨ Chatroom Demo</div>
                <div class="description">Test the client polling interface</div>
            </a>

            <a href="/admin/add-youtube-topic.html" class="admin-link">
                <div class="title">üì∫ Add YouTube Topics</div>
                <div class="description">Add YouTube videos as conversation topics</div>
            </a>

            <a href="/admin/conversation-viewer.html" class="admin-link">
                <div class="title">ü§ñ AI Conversation Viewer</div>
                <div class="description">Compare base AI conversations with user-personalized views</div>
            </a>

            <a href="/admin/trait-analytics.html" class="admin-link">
                <div class="title">üìä Trait Analytics</div>
                <div class="description">View trait score distributions by body type and rarity</div>
            </a>

            <a href="/admin/bodytype-admin.html" class="admin-link">
                <div class="title">üé≠ Body Type Admin</div>
                <div class="description">Create and manage creature body types</div>
            </a>

            <a href="/admin/avatar-queue.html" class="admin-link">
                <div class="title">üé® Avatar Generation Queue</div>
                <div class="description">Monitor user avatar image generation requests</div>
            </a>

            <a href="/user" class="admin-link">
                <div class="title">üë• User Hub</div>
                <div class="description">Main user interface</div>
            </a>

            <!-- YouTube Check Trigger -->
            <button onclick="triggerYouTubeCheck()" id="youtube-check-btn" class="admin-link" style="border: none; cursor: pointer; font-family: inherit;">
                <div class="title">‚ñ∂Ô∏è Trigger YouTube Check</div>
                <div class="description">Manually run YouTube likes check for active users</div>
            </button>
        </div>

        <!-- YouTube Check Results -->
        <div id="youtube-results" style="display: none; margin-top: 20px; padding: 20px; background: #f0f0ff; border-radius: 10px; border-left: 4px solid #667eea;">
            <h3 style="color: #667eea; margin-bottom: 15px;">üìä YouTube Check Results</h3>
            <div id="results-content"></div>
        </div>

        <div class="status">
            <strong>Status:</strong> Procedural chat system active<br>
            <strong>Chat Lines:</strong> 65 pre-approved messages<br>
            <strong>Flow Rules:</strong> 19 state transitions
        </div>
    </div>

    <script>
        async function triggerYouTubeCheck() {
            const btn = document.getElementById('youtube-check-btn');
            const resultsDiv = document.getElementById('youtube-results');
            const resultsContent = document.getElementById('results-content');

            // Disable button and show loading state
            btn.disabled = true;
            btn.style.opacity = '0.6';
            btn.querySelector('.description').textContent = 'Running YouTube check...';

            // Show results area with loading message
            resultsDiv.style.display = 'block';
            resultsContent.innerHTML = '<p style="color: #667eea;">üîÑ Running YouTube check... This may take a minute.</p>';

            try {
                const response = await fetch('/admin/trigger-youtube-check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    const results = data.results;
                    const timestamp = new Date(results.timestamp).toLocaleString();

                    resultsContent.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;">
                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2em; color: #667eea;">üë•</div>
                                <div style="font-size: 1.5em; font-weight: bold; color: #333;">${results.totalEligible || results.totalUsers}</div>
                                <div style="color: #666; font-size: 0.9em;">Total Eligible</div>
                            </div>

                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2em; color: #3498db;">üì¶</div>
                                <div style="font-size: 1.5em; font-weight: bold; color: #333;">${results.batchSize || results.totalUsers}</div>
                                <div style="color: #666; font-size: 0.9em;">Batch Size</div>
                            </div>

                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2em; color: #27ae60;">‚úÖ</div>
                                <div style="font-size: 1.5em; font-weight: bold; color: #333;">${results.successCount}</div>
                                <div style="color: #666; font-size: 0.9em;">Checked</div>
                            </div>

                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2em; color: #f39c12;">üéÅ</div>
                                <div style="font-size: 1.5em; font-weight: bold; color: #333;">${results.newChatlings}</div>
                                <div style="color: #666; font-size: 0.9em;">New Chatlings</div>
                            </div>

                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2em; color: ${results.errorCount > 0 ? '#e74c3c' : '#95a5a6'};">‚ùå</div>
                                <div style="font-size: 1.5em; font-weight: bold; color: #333;">${results.errorCount}</div>
                                <div style="color: #666; font-size: 0.9em;">Errors</div>
                            </div>

                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2em; color: #e67e22;">‚ö°</div>
                                <div style="font-size: 1.5em; font-weight: bold; color: #333;">${results.quotaUsed || (results.successCount * 3)}</div>
                                <div style="color: #666; font-size: 0.9em;">Quota Used</div>
                            </div>

                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2em; color: #9b59b6;">‚è±Ô∏è</div>
                                <div style="font-size: 1.5em; font-weight: bold; color: #333;">${results.duration.toFixed(1)}s</div>
                                <div style="color: #666; font-size: 0.9em;">Duration</div>
                            </div>
                        </div>

                        <div style="margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.7); border-radius: 6px; font-size: 0.9em; color: #666;">
                            <strong>Completed:</strong> ${timestamp}
                        </div>

                        <div style="margin-top: 10px; padding: 10px; background: rgba(39, 174, 96, 0.1); border-radius: 6px; color: #27ae60; font-size: 0.9em;">
                            ‚úì Check completed successfully! Console has detailed output.
                        </div>
                    `;
                } else {
                    resultsContent.innerHTML = `
                        <div style="padding: 15px; background: rgba(231, 76, 60, 0.1); border-radius: 6px; color: #e74c3c;">
                            <strong>‚ùå Error:</strong> ${data.error || 'Unknown error occurred'}
                        </div>
                    `;
                }

            } catch (error) {
                console.error('Error triggering YouTube check:', error);
                resultsContent.innerHTML = `
                    <div style="padding: 15px; background: rgba(231, 76, 60, 0.1); border-radius: 6px; color: #e74c3c;">
                        <strong>‚ùå Error:</strong> ${error.message || 'Unknown error occurred'}
                        <br><small>Check browser console for details</small>
                    </div>
                `;
            } finally {
                // Re-enable button
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.querySelector('.description').textContent = 'Manually run YouTube likes check for active users';
            }
        }
    </script>
</body>
</html>
